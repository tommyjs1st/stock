    def process_sell_for_symbol(self, symbol: str, position: dict):
        """ë³´ìˆ˜ì  ë§¤ë„ ì²˜ë¦¬ - ì¢‹ì€ ì¢…ëª© ë³´í˜¸ ìš°ì„ """
        try:
            if symbol not in self.all_positions:
                return
                
            quantity = position['quantity']
            profit_loss_pct = position['profit_loss']
            profit_loss_decimal = profit_loss_pct / 100
            stock_name = self.get_stock_name(symbol)
            current_price = position['current_price']
            
            # ğŸ”¥ 1ìˆœìœ„: ê·¹ë‹¨ì  ì†ì‹¤ ë°©ì§€ (-7% ì´ìƒ ì†ì‹¤ì‹œ ë¬´ì¡°ê±´ ì†ì ˆ) - ê¸°ì¡´ ìœ ì§€
            if profit_loss_decimal <= -0.07:
                self.logger.warning(f"ğŸ›‘ {stock_name}({symbol}) ê·¹í•œ ì†ì ˆ! ({profit_loss_pct:+.2f}%)")
                self.execute_sell(symbol, quantity, "urgent", "ê·¹í•œì†ì ˆ")
                return
            
            # ğŸ”¥ 2ìˆœìœ„: ë‹¨ê³„ì  ìµì ˆ ì‹œìŠ¤í…œ - ê¸°ì¡´ ìœ ì§€  
            if profit_loss_decimal >= 0.15:  # 15% ì´ìƒ ìµì ˆ
                can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                if can_sell:
                    self.logger.info(f"ğŸ¯ {stock_name}({symbol}) 1ì°¨ ìµì ˆ! ({profit_loss_pct:+.2f}%)")
                    self.execute_sell(symbol, quantity, "aggressive_limit", "1ì°¨ìµì ˆ")
                    return
            elif profit_loss_decimal >= 0.10:  # 10% ì´ìƒì—ì„œ ê¸°ìˆ ì  í™•ì¸ í›„ ìµì ˆ
                daily_analysis = self.hybrid_strategy.analyze_daily_strategy(symbol)
                if daily_analysis['signal'] == 'SELL' and daily_analysis['strength'] >= 2.0:
                    can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                    if can_sell:
                        self.logger.info(f"ğŸ¯ {stock_name}({symbol}) ê¸°ìˆ ì  ìµì ˆ! ({profit_loss_pct:+.2f}%)")
                        self.execute_sell(symbol, quantity, "aggressive_limit", "ê¸°ìˆ ì ìµì ˆ")
                        return
            
            # ğŸ†• 3ìˆœìœ„: í˜„ì¬ ìƒìŠ¹ ì¤‘ì´ë©´ ë¯¸ë˜ ì ìˆ˜ ë¬´ì‹œí•˜ê³  ë³´ìœ  (NEW!)
            daily_analysis = self.hybrid_strategy.analyze_daily_strategy(symbol)
            if daily_analysis['signal'] == 'BUY' and daily_analysis['strength'] >= 3.0:
                self.logger.info(f"ğŸ“ˆ {stock_name}({symbol}) ìƒìŠ¹ì‹ í˜¸ë¡œ ë³´ìœ ìœ ì§€: "
                               f"ë§¤ìˆ˜ì‹ í˜¸ {daily_analysis['strength']:.1f}ì  ({profit_loss_pct:+.2f}%)")
                return
            
            # ğŸ†• 4ìˆœìœ„: ë§¤ìš° ë³´ìˆ˜ì ì¸ ì ˆëŒ€ ì ìˆ˜ ê¸°ì¤€ (25ì  ë¯¸ë§Œìœ¼ë¡œ ì™„í™”)
            try:
                future_analysis = self.calculate_future_potential(symbol)
                future_score = future_analysis['total_score']
                
                # ë§¤ìš° ë‚®ì€ ì ìˆ˜ + ì†ì‹¤ì¸ ê²½ìš°ë§Œ ë§¤ë„
                if future_score < 25 and profit_loss_decimal < -0.05:  # 25ì  ë¯¸ë§Œ + 5% ì´ìƒ ì†ì‹¤
                    can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                    if can_sell:
                        self.logger.warning(f"ğŸ“Š {stock_name}({symbol}) ê·¹ì €ì ìˆ˜+ì†ì‹¤ë§¤ë„: "
                                          f"{future_score:.1f}ì  + {profit_loss_pct:+.2f}%")
                        self.execute_sell(symbol, quantity, "aggressive_limit", "ê·¹ì €ì ìˆ˜ë§¤ë„")
                        return
                
                # ë§¤ìš° í° ì†ì‹¤ + ì ìˆ˜ ë‚®ìŒ
                elif profit_loss_decimal < -0.12 and future_score < 40:  # 12% ì´ìƒ ì†ì‹¤ + 40ì  ë¯¸ë§Œ
                    can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                    if can_sell:
                        self.logger.warning(f"ğŸ“Š {stock_name}({symbol}) í°ì†ì‹¤+ì ìˆ˜ë§¤ë„: "
                                          f"{future_score:.1f}ì  + {profit_loss_pct:+.2f}%")
                        self.execute_sell(symbol, quantity, "aggressive_limit", "í°ì†ì‹¤ë§¤ë„")
                        return
                
            except Exception as e:
                self.logger.error(f"ë¯¸ë˜ ì ìˆ˜ ê³„ì‚° ì˜¤ë¥˜ ({symbol}): {e}")
                # ì˜¤ë¥˜ ë°œìƒì‹œ ê¸°ì¡´ ë¡œì§ìœ¼ë¡œ ì§„í–‰
            
            # ğŸ”¥ 5ìˆœìœ„: ì§€ëŠ¥í˜• ì†ì ˆ íŒë‹¨ (-3% ~ -7% êµ¬ê°„) - ê¸°ì¡´ ìœ ì§€
            if -0.07 < profit_loss_decimal <= -0.03:
                recovery_analysis = self.analyze_recovery_potential(symbol, current_price)
                
                if recovery_analysis['should_hold']:
                    self.logger.info(f"ğŸ’ {stock_name}({symbol}) ì†ì ˆ ë³´ë¥˜: {recovery_analysis['reason']} "
                                   f"(í˜„ì¬: {profit_loss_pct:+.2f}%)")
                    return
                else:
                    self.logger.warning(f"ğŸ›‘ {stock_name}({symbol}) ì§€ëŠ¥í˜• ì†ì ˆ: {recovery_analysis['reason']} "
                                      f"({profit_loss_pct:+.2f}%)")
                    self.execute_sell(symbol, quantity, "aggressive_limit", "ì§€ëŠ¥í˜•ì†ì ˆ")
                    return
            
            # ğŸ”¥ 6ìˆœìœ„: ê¸‰ë½ ê°ì§€ - ê¸°ì¡´ ìœ ì§€
            rapid_drop = self.check_rapid_drop(symbol, current_price)
            if rapid_drop['should_sell']:
                recovery_analysis = self.analyze_recovery_potential(symbol, current_price)
                
                if recovery_analysis['strong_recovery_signal']:
                    self.logger.info(f"ğŸ”„ {stock_name}({symbol}) ê¸‰ë½ì´ì§€ë§Œ íšŒë³µ ì‹ í˜¸ë¡œ ë³´ìœ : {recovery_analysis['reason']}")
                    return
                else:
                    self.logger.warning(f"ğŸ’¥ {stock_name}({symbol}) ê¸‰ë½ ë§¤ë„: {rapid_drop['reason']}")
                    self.execute_sell(symbol, quantity, "urgent", rapid_drop['reason'])
                    return
            
            # ğŸ”¥ 7ìˆœìœ„: ì¼ë°˜ì  ê¸°ìˆ ì  ë§¤ë„ (ê¸°ì¤€ ê°•í™”)
            if symbol in self.symbols:
                if daily_analysis['signal'] == 'SELL' and daily_analysis['strength'] >= 3.5:  # 2.5 â†’ 3.5ë¡œ ê°•í™”
                    can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                    
                    if can_sell:
                        self.logger.info(f"ğŸ“‰ {stock_name}({symbol}) ê°•í•œ ê¸°ìˆ ì  ë§¤ë„ ì‹ í˜¸")
                        self.execute_sell(symbol, quantity, "aggressive_limit", "ê¸°ìˆ ì ë§¤ë„")
                        return
            
            # ğŸ”¥ 8ìˆœìœ„: ì¥ê¸° ë³´ìœ  ìµì ˆ - ê¸°ì¡´ ìœ ì§€
            if profit_loss_decimal >= 0.05:
                position_summary = self.position_manager.get_position_summary(symbol)
                first_purchase = position_summary.get('first_purchase_time')
                
                if first_purchase:
                    first_time = datetime.fromisoformat(first_purchase)
                    holding_days = (datetime.now() - first_time).total_seconds() / (24 * 3600)
                    
                    if holding_days >= 5:  # 5ì¼ ì´ìƒ ë³´ìœ 
                        can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                        if can_sell:
                            self.logger.info(f"â° {stock_name}({symbol}) ì¥ê¸°ë³´ìœ  ìµì ˆ: {holding_days:.1f}ì¼ ë³´ìœ  ({profit_loss_pct:+.2f}%)")
                            self.execute_sell(symbol, quantity, "aggressive_limit", "ì¥ê¸°ìµì ˆ")
                            return
            
            # ë³´ìœ  ìœ ì§€ ë¡œê·¸ (ë¯¸ë˜ ì ìˆ˜ í¬í•¨)
            try:
                future_score = future_analysis.get('total_score', 50) if 'future_analysis' in locals() else 50
                self.logger.info(f"ğŸ’ {stock_name}({symbol}) ë³´ìœ ìœ ì§€: "
                               f"ìˆ˜ìµë¥  {profit_loss_pct:+.2f}%, ì˜ˆìƒì ìˆ˜ {future_score:.1f}ì ")
            except:
                self.logger.info(f"ğŸ’ {stock_name}({symbol}) ë³´ìœ ìœ ì§€: ìˆ˜ìµë¥  {profit_loss_pct:+.2f}%")
                    
        except Exception as e:
            self.logger.error(f"{symbol} ë§¤ë„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: {e}")
    
    
    def execute_portfolio_optimization_sell(self):
        """
        í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë§¤ë„ (ì£¼ 1íšŒë§Œ ì‹¤í–‰) - ë”ìš± ë³´ìˆ˜ì ìœ¼ë¡œ
        """
        try:
            current_day = datetime.now().weekday()
            
            # ê¸ˆìš”ì¼(4)ì—ë§Œ ì‹¤í–‰ (ì£¼ 1íšŒë¡œ ì¶•ì†Œ)
            if current_day != 4:
                return
            
            # 5ê°œ ì´ìƒ ë³´ìœ ì‹œë§Œ ì‹¤í–‰ (3ê°œ â†’ 5ê°œë¡œ ìƒí–¥)
            if len(self.all_positions) < 5:
                self.logger.info("ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”: ë³´ìœ ì¢…ëª© 5ê°œ ë¯¸ë§Œìœ¼ë¡œ ìŠ¤í‚µ")
                return
            
            self.logger.info("ğŸ¯ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë§¤ë„ ë¶„ì„ ì‹œì‘ (ì£¼ 1íšŒ)")
            
            # ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„
            try:
                portfolio_analysis = self.evaluate_portfolio_optimization()
                sell_candidates = portfolio_analysis.get('sell_candidates', [])
            except Exception as e:
                self.logger.error(f"í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ì˜¤ë¥˜: {e}")
                return
            
            if not sell_candidates:
                self.logger.info("ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”: ë§¤ë„ í›„ë³´ ì—†ìŒ")
                return
            
            # ë§¤ìš° ì—„ê²©í•œ ê¸°ì¤€ìœ¼ë¡œë§Œ ë§¤ë„
            worst_candidate = sell_candidates[0]
            symbol = worst_candidate['symbol']
            combined_score = worst_candidate['combined_score']
            current_return = worst_candidate['current_return']
            
            # ë§¤ìš° ë‚®ì€ ì ìˆ˜ + í° ì†ì‹¤ì¸ ê²½ìš°ë§Œ ë§¤ë„ (ê¸°ì¤€ ê°•í™”)
            if combined_score < 30 and current_return < -12:  # 30ì  ë¯¸ë§Œ + 12% ì´ìƒ ì†ì‹¤
                position = self.all_positions.get(symbol)
                if position:
                    quantity = position['quantity']
                    can_sell, sell_reason = self.position_manager.can_sell_symbol(symbol, quantity)
                    
                    if can_sell:
                        stock_name = self.get_stock_name(symbol)
                        self.logger.warning(f"ğŸ¯ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë§¤ë„: {stock_name}({symbol}) "
                                          f"ì ìˆ˜ {combined_score:.1f}ì , ìˆ˜ìµë¥  {current_return:+.2f}%")
                        self.execute_sell(symbol, quantity, "limit", "í¬íŠ¸í´ë¦¬ì˜¤ìµœì í™”")
                    else:
                        self.logger.info(f"ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”: {symbol} ë§¤ë„ ë¶ˆê°€ - {sell_reason}")
            else:
                self.logger.info(f"ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™”: í•˜ìœ„ì¢…ëª©ë„ ë³´ìœ  ê¸°ì¤€ ì¶©ì¡± "
                               f"(ì ìˆ˜: {combined_score:.1f}, ìˆ˜ìµë¥ : {current_return:+.2f}%)")
        
        except Exception as e:
            self.logger.error(f"í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ë§¤ë„ ì˜¤ë¥˜: {e}")
    
