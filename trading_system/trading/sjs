def calculate_position_size(self, current_price: float, signal_strength: float, 
                           price_position: float, volatility: float, symbol: str = None) -> int:
    try:
        account_data = self.api_client.get_account_balance()
        if not account_data:
            return 0

        output = account_data.get('output', {})
        available_cash = float(output.get('ord_psbl_cash', 0))
        total_deposit = float(output.get('dnca_tot_amt', 0))
        
        # 1. ê³„ì¢Œ ì •ë³´ ë¡œê¹…
        if symbol:  # ì²« ë²ˆì§¸ ì¢…ëª©ì—ì„œë§Œ ë¡œê¹… (ì¤‘ë³µ ë°©ì§€)
            self.logger.info("ğŸ’³ ê³„ì¢Œ í˜„í™©:")
            self.logger.info(f"  ì´ ì˜ˆìˆ˜ê¸ˆ: {total_deposit:,.0f}ì›")
            self.logger.info(f"  ì£¼ë¬¸ê°€ëŠ¥: {available_cash:,.0f}ì›")
            
            if total_deposit > available_cash + 50000:
                pending_settlement = total_deposit - available_cash
                self.logger.warning(f"âš ï¸ T+2 ê²°ì œ ëŒ€ê¸°ì¤‘: ì•½ {pending_settlement:,.0f}ì›")
        
        # 2. ì•ˆì „ ë§ˆì§„ ì ìš©í•œ ì‚¬ìš©ê°€ëŠ¥ê¸ˆì•¡ ê³„ì‚°
        safety_margin = 50000
        safe_amount = max(0, available_cash - safety_margin)
        
        if safe_amount < 30000:
            if symbol:
                stock_name = self.get_stock_name(symbol) if self.get_stock_name else symbol
                self.logger.warning(f"âš ï¸ {stock_name}({symbol}) ì•ˆì „ì‚¬ìš©ê¸ˆì•¡ ë¶€ì¡±: {safe_amount:,.0f}ì›")
            return 0
        
        # 3. ì‹¤ì œ í¬ì§€ì…˜ í¬ê¸° ê³„ì‚°
        max_investment = safe_amount * 0.5  # 50%ë§Œ ì‚¬ìš©
        quantity = int(max_investment / current_price)
        
        if symbol:
            stock_name = self.get_stock_name(symbol) if self.get_stock_name else symbol
            self.logger.info(f"ğŸ“Š {stock_name}({symbol}) ì•ˆì „ í¬ì§€ì…˜:")
            self.logger.info(f"  ì•ˆì „ì‚¬ìš©ì•¡: {safe_amount:,.0f}ì›")
            self.logger.info(f"  ìµœëŒ€íˆ¬ì: {max_investment:,.0f}ì› â†’ {quantity}ì£¼")
        
        return max(quantity, 0)
        
    except Exception as e:
        self.logger.error(f"í¬ì§€ì…˜ ê³„ì‚° ì˜¤ë¥˜: {e}")
        return 0
