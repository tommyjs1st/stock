# 급락 매수 전략 사용법

## 📋 전략 개요

- **대상**: 코스피 시가총액 상위 200개 종목 (제외 목록 제외)
- **매수 시간**: 9:00 ~ 9:30
- **매수 조건**: 전일 종가 대비 15% 이상 하락
- **매도 시간**: 오후 3시 (15:00)
- **중요**: **당일 급락매수한 종목만 매도** (다른 보유 종목은 매도 안함)

## 🚀 실행 방법

### 1단계: 전일 종가 데이터 수집 (필수)

```bash
cd /Users/jsshin/RESTAPI/analyze
python daily_collector.py --daily
```

### 2단계: 프로그램 실행 (오전 8:50~8:55 권장)

```bash
cd /Users/jsshin/RESTAPI/trading_system
python3 sharp_decline_trader.py

# 또는
./run_sharp_decline.sh
```

## ⚙️ 제외 종목 설정 (선택)

`exclude_stocks.json` 파일 수정:

```json
[
  "005930",
  "000660"
]
```

## 📊 프로그램 동작

```
8:50  프로그램 시작
      ↓
      코스피 상위 200개 종목 조회
      전일 종가 데이터 로드
      ↓
9:00  매수 모니터링 시작
~     전일 종가 대비 15% 이상 하락 종목 발견 시
9:30  시장가 매수 (purchased_stocks에 기록)
      ↓
15:00 당일 급락매수한 종목만 시장가 전량 매도
      ↓
      프로그램 종료
```

## ⚠️ 중요 사항

### ✅ 안전장치

1. **당일 급락매수 종목만 매도**: `purchased_stocks`에 기록된 종목만 매도
2. **계좌 확인**: 매도 전 계좌에 실제로 보유하고 있는지 확인
3. **전략 구분**: 각 매수 기록에 `strategy: 'sharp_decline'` 태그 추가

### ❌ 매도하지 않는 종목

- 다른 전략(main.py)으로 매수한 종목
- 이전에 매수해서 보유 중인 종목
- 수동으로 매수한 종목

### 📝 로그 확인

```bash
tail -f logs/sharp_decline_trader_*.log
```

## 🔧 하락률 조정

`sharp_decline_trader.py` 파일 수정:

```python
self.decline_threshold = 0.15  # 15% → 원하는 비율로 변경
```

## 📁 생성 파일

- `purchased_stocks_YYYYMMDD.json`: 당일 급락매수 종목 목록
- `stock_names.json`: 종목명 캐시

## 🔔 Discord 알림

- 프로그램 시작/종료
- 급락 감지 및 매수
- 매도 완료
- 오류 발생
