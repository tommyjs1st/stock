    def calculate_buy_signal_score(df, name, code, foreign_trend=None, foreign_netbuy_list=None):
        """
        ì ˆëŒ€ì¡°ê±´ í•„í„°ë§ì´ ì ìš©ëœ ì¢…í•© ë§¤ìˆ˜ ì‹ í˜¸ ì ìˆ˜ ê³„ì‚° (ê°œì„ ëœ ì™¸êµ­ì¸ ì¡°ê±´)
        
        Returns:
            tuple: (ì ìˆ˜, í™œì„±ì‹ í˜¸ë¦¬ìŠ¤íŠ¸, ì ˆëŒ€ì¡°ê±´í†µê³¼ì—¬ë¶€, ì œì™¸ì‚¬ìœ )
        """
        try:
            if df is None or df.empty:
                return 0, [], False, "ë°ì´í„° ì—†ìŒ"
            
            # 1. ì ˆëŒ€ì¡°ê±´ ì²´í¬ ë¨¼ì € ìˆ˜í–‰
            absolute_check = get_comprehensive_analysis_updated(df, foreign_netbuy_list, name)
            
            if not absolute_check['meets_absolute_conditions']:
                reasons = []
                if not absolute_check['price_below_ma20']:
                    reasons.append("í˜„ì¬ê°€ê°€ 20ì¼ì„  ìœ„")
                if not absolute_check.get('volume_sufficient', True):
                    reasons.append("ê±°ë˜ëŸ‰ 1000ì£¼ ë¯¸ë§Œ")
                if not absolute_check.get('above_bollinger_lower', True):
                    reasons.append("ë³¼ë¦°ì €ë°´ë“œ í•˜ë‹¨ ì´íƒˆ")
                
                # ì™¸êµ­ì¸ ì¡°ê±´ ì²´í¬ (ğŸ†• ê°œì„ )
                foreign_check = absolute_check.get('foreign_consecutive_buying')
                if foreign_check and not foreign_check['meets_condition']:
                    reasons.append(f"ì™¸êµ­ì¸({foreign_check['reason']})")
                
                return 0, [], False, " + ".join(reasons)
            
            # 2. ì ˆëŒ€ì¡°ê±´ í†µê³¼ì‹œì—ë§Œ ìƒì„¸ ì‹ í˜¸ ë¶„ì„
            from technical_indicators import TechnicalIndicators
            
            # ì™¸êµ­ì¸ ì—°ì† ë§¤ìˆ˜ ì •ë³´ ì¶”ì¶œ
            foreign_check = absolute_check.get('foreign_consecutive_buying', {})
            consecutive_days = foreign_check.get('consecutive_days', 0)
            
            signals = {
                "ê³¨ë“ í¬ë¡œìŠ¤": TechnicalIndicators.is_golden_cross(df),
                "ë³¼ë¦°ì €ë°´ë“œë³µê·€": TechnicalIndicators.is_bollinger_rebound(df),
                "ê±°ë˜ëŸ‰ê¸‰ì¦": TechnicalIndicators.is_volume_breakout(df),
                "í˜„ì¬ê°€20ì¼ì„ ì•„ë˜": TechnicalIndicators.is_price_below_ma20(df, name),
                "5ì¼ì„ 20ì¼ì„ ëŒíŒŒ": TechnicalIndicators.is_ma5_crossing_above_ma20(df),
                "RSIë§¤ìˆ˜ì‹ í˜¸": TechnicalIndicators.is_rsi_buy_signal(df),
                "MACDê³¨ë“ í¬ë¡œìŠ¤": TechnicalIndicators.is_macd_golden_cross(df),
                "MACDëŒíŒŒì§ì „": TechnicalIndicators.is_macd_near_golden_cross(df),
                "ë³¼ë¦°ì €ë°´ë“œë‚´ìœ„ì¹˜": TechnicalIndicators.is_price_above_bollinger_lower(df),
                "ì™¸êµ­ì¸ì—°ì†ë§¤ìˆ˜": consecutive_days >= 2  # ğŸ†• 2ì¼ ì´ìƒ ì—°ì† ë§¤ìˆ˜
            }
            
            # ì—°ì† ë§¤ìˆ˜ ì¼ìˆ˜ì— ë”°ë¥¸ ì¶”ê°€ ì ìˆ˜ (ì„ íƒì‚¬í•­)
            if consecutive_days >= 3:
                signals["ì™¸êµ­ì¸ê°•ë ¥ë§¤ìˆ˜"] = True  # ë³´ë„ˆìŠ¤ ì‹ í˜¸
            
            score = sum(signals.values())
            active_signals = [key for key, value in signals.items() if value]
    
            return score, active_signals, True, "ì ˆëŒ€ì¡°ê±´ ëª¨ë‘ í†µê³¼"
            
        except Exception as e:
            print(f"âŒ {name}: ë§¤ìˆ˜ ì‹ í˜¸ ì ìˆ˜ ê³„ì‚° ì˜¤ë¥˜: {e}")
            return 0, [], False, f"ê³„ì‚° ì˜¤ë¥˜: {e}"
    
